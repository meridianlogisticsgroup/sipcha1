{% set title = title or 'Sipcha Admin' %}
<!doctype html>
<html lang="en" x-data="{ dark: localStorage.theme==='dark', sidebar:true }"
      x-init="$watch('dark', v => { document.documentElement.classList.toggle('theme-dark', v); localStorage.theme = v ? 'dark' : 'light'; })">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta21/dist/css/tabler.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='ui.css') }}" rel="stylesheet" />
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://unpkg.com/htmx.org@2.0.3"></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
  <script>
    // Fade transitions
    document.addEventListener('htmx:beforeSwap', (e) => {
      const app = document.getElementById('app');
      if(app){ app.classList.add('app-fade'); }
    });
    document.addEventListener('htmx:afterSwap', (e) => {
      const app = document.getElementById('app');
      if(app){ requestAnimationFrame(()=>app.classList.remove('app-fade')); }
    });
    // 401 to login via HX-Redirect is handled by htmx automatically.
  </script>
</head>
<body hx-boost="true" hx-target="#app" hx-push-url="true">
  <div class="page">
    <header class="navbar navbar-light px-0" style="height:64px">
      <div class="container-xl d-flex align-items-center">
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-link px-2 d-md-none" type="button" @click="sidebar=!sidebar">
            <i class="ti ti-menu-2"></i>
          </button>
          <span class="brand-badge" style="display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#22c55e,#3b82f6);color:#fff;font-weight:700;">SC</span>
          <span class="ms-2 fw-semibold">Sipcha Admin</span>
        </div>
        <div class="ms-auto d-flex align-items-center gap-3">
          <span class="htmx-indicator"><i class="ti ti-loader-2 ti-spin"></i></span>
          <button class="btn btn-link" @click.prevent="dark=!dark" title="Toggle theme">
            <i :class="dark ? 'ti ti-moon-stars' : 'ti ti-sun'"></i>
          </button>
          {% if user %}
          <form method="post" action="{{ url_for('logout') }}">
            <button class="btn btn-outline-danger btn-sm">Logout</button>
          </form>
          <span class="avatar-initials ms-2" title="{{ user.name if user else '' }}" style="width:32px;height:32px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#1e293b;color:#fff;font-weight:600;">{{ (user.avatar if user else 'SC') }}</span>
          {% endif %}
        </div>
      </div>
    </header>

    <div class="page-wrapper">
      <div class="container-xl my-3">
        <div class="row g-3">
          <aside class="col-12 col-md-3 col-xl-2" x-show="sidebar" x-transition hx-preserve="true">
            <div class="glass p-3" style="backdrop-filter: blur(12px) saturate(140%); background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.5)); border-radius:14px;">
              <div class="list-group list-group-transparent">
                <a href="{{ url_for('dashboard') }}" class="list-group-item list-group-item-action d-flex align-items-center {% if request.path == '/' %}active{% endif %}">
                  <i class="ti ti-dashboard me-2"></i> Dashboard
                </a>
                <a href="{{ url_for('admins_index') }}" class="list-group-item list-group-item-action d-flex align-items-center {% if request.path.startswith('/admins') %}active{% endif %}">
                  <i class="ti ti-users me-2"></i> Admins
                </a>
              </div>
              <div class="small text-muted mt-3">v0.3 â€¢ HTMX SPA</div>
            </div>
          </aside>

          <main :class="sidebar ? 'col-12 col-md-9 col-xl-10' : 'col-12'">
            <div id="app">
              {% include content_template %}
            </div>
          </main>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta21/dist/js/tabler.min.js"></script>
</body>
</html>
